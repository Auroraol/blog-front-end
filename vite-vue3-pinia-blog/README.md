### åç«¯æŠ€æœ¯

| æŠ€æœ¯            | è¯´æ˜                       | å®˜ç½‘é“¾æ¥                                                     |
| --------------- | -------------------------- | ------------------------------------------------------------ |
| Spring Boot     | MVC æ¡†æ¶                   | [https://spring.io/projects/spring-boot](https://spring.io/projects/spring-boot) |
| Spring Security | è®¤è¯å’Œæˆæƒå®‰å…¨æ¡†æ¶         | [https://spring.io/projects/spring-security](https://spring.io/projects/spring-security) |
| MyBatis Plus    | ORM æ¡†æ¶                   | [https://mp.baomidou.com](https://mp.baomidou.com)           |
| Knife4j         | æ¥å£æ–‡æ¡£ç®¡ç†æ¡†æ¶           | [https://doc.xiaominfo.com](https://doc.xiaominfo.com)       |
| Redis           | ç¼“å­˜æ¡†æ¶                   | [https://redis.io](https://redis.io)                         |
| Lombok          | å¯¹è±¡å°è£…å·¥å…·               | [https://github.com/projectlombok/lombok](https://github.com/projectlombok/lombok) |
| Nginx           | Http å’Œåå‘ä»£ç† Web æœåŠ¡å™¨ | [http://nginx.org](http://nginx.org)                         |
| JustAuth        | ç¬¬ä¸‰æ–¹ç™»å½•å·¥å…·             | [https://www.justauth.cn](https://www.justauth.cn)           |

### å‰ç«¯æŠ€æœ¯

| è¯´æ˜             | å®˜ç½‘                                                         |
| ---------------- | ------------------------------------------------------------ |
| å‰ç«¯æ¡†æ¶         | [https://vuejs.org](https://vuejs.org)                       |
| è·¯ç”±æ¡†æ¶         | [https://router.vuejs.org](https://router.vuejs.org)         |
| å…¨å±€çŠ¶æ€ç®¡ç†æ¡†æ¶ | [https://vuex.vuejs.org](https://vuex.vuejs.org)             |
| å‰ç«¯ UI æ¡†æ¶     | [https://element-plus.gitee.io](https://element-plus.gitee.io) |
| å‰ç«¯ Http æ¡†æ¶   | [https://github.com/axios/axios](https://github.com/axios/axios) |
| å¯Œæ–‡æœ¬ç¼–è¾‘å™¨     | [https://www.wangeditor.com](https://www.wangeditor.com)     |
| Markdown ç¼–è¾‘å™¨  | [http://ckang1229.gitee.io/vue-markdown-editor/zh](http://ckang1229.gitee.io/vue-markdown-editor/zh) |
| ä»£ç è¯­æ³•é«˜äº®æ’ä»¶ | [https://github.com/highlightjs/highlight.js](https://github.com/highlightjs/highlight.js) |

## License

# è¯´æ˜

## å‰ç«¯

**å‰ç«¯æ¡†æ¶**ï¼š**vite-vue3**

- è‡ªåŠ¨å¯¼å…¥: [unplugin-auto-import]()
- Markdown åœ¨çº¿ç¼–è¾‘å™¨: [MdEditorV3 ](https://imzbf.github.io/md-editor-v3/zh-CN/demo#ğŸ¥± Setup æ¨¡æ¿) 
  + å‚è€ƒ: [ä½¿ç”¨è¯´æ˜](https://blog.csdn.net/qq_16992475/article/details/130899269)
- Hook&api: [VueHook Plus](https://inhiblab-core.gitee.io/docs/hooks/guide/)
- çŠ¶æ€ç®¡ç†åº“: [pinia](https://pinia.vuejs.org/api/modules/pinia.html#Type-Aliases)
- UI:
  - [Element Plus ](https://element-plus.org/zh-CN/component/button.html)
  - [iconfont-é˜¿é‡Œå·´å·´çŸ¢é‡å›¾æ ‡åº“](https://www.iconfont.cn/?spm=a313x.search_index.i3.2.52c93a81WpIhXZ)
- å…¶ä»–: htmlã€cssã€ lessã€ js
- åŠ¨ç”»: [GSAP ](https://gsap.framer.wiki/)

## åç«¯

**åç«¯æ¡†æ¶: springboot**

- å…¨æ–‡æœç´¢å¼•æ“: es
- æ•°æ®åº“å®šæœŸå¤‡ä»½å’Œå®šæœŸåˆ é™¤
- æ•°æ®åº“: Mybatis(MySQL)
- å®æ—¶æ¨é€: WebSocket
- JMX
- åˆ†å¸ƒå¼ç›¸å…³ï¼š

  - Redis(åˆ†å¸ƒå¼ç¼“å­˜)
  - Redisson(åˆ†å¸ƒå¼é”)

- äººè„¸è¯†åˆ«
- æ•æ„Ÿæ•°æ®çš„ä¿æŠ¤ä¼â€”â€”SpringBooté›†æˆjasypt

## å…¶ä»–

**éƒ¨ç½²**ï¼šTomcatã€Nginxã€é˜¿é‡Œäº‘æœåŠ¡å™¨ã€ä¸ƒç‰›äº‘ CDN

**Python ç›¸å…³**ï¼šç™¾åº¦ç»Ÿè®¡çš„è·å–ã€Flask æä¾›æ–‡æœ¬åˆ†æ API

**å…¶ä»–**ï¼šMongoDBï¼ˆç›®å‰åªç”¨æ¥è®°å½•æ•°æ®åº“å¯åŠ¨ï¼‰ã€RabbitMQï¼ˆç›®å‰åªç”¨æ¥è®°å½•è¯·æ±‚ï¼‰ã€ç•…è¨€

---

æ—¥å¿—ç³»ç»Ÿçš„å»ºç«‹

å‚è€ƒ:

- æ–‡ç«  4.æ—¥å¿—ç³»ç»Ÿ.md

---

nginx è´Ÿè½½å‡è¡¡

å‚è€ƒ:

- nginx ä½¿ç”¨

---

ç½‘ç«™æ€§èƒ½ä¼˜åŒ–

å‚è€ƒ:

- ç½‘ç«™æ€§èƒ½ä¼˜åŒ–.md

# ç™»å½•-JWT+Redis ç¼“å­˜

## æ¥å£è¯´æ˜

æ¥å£urlï¼šhttp://localhost:9000/user/login

è¯·æ±‚æ–¹å¼ï¼šPOST  

è¯·æ±‚å‚æ•°ï¼š

| å‚æ•°åç§°     | å‚æ•°ç±»å‹ | è¯´æ˜   |
| ------------ | -------- | ------ |
| **username** | string   | ç”¨æˆ·å |
| **password** | string   | å¯†ç    |

è¿”å›æ•°æ®ï¼š

~~~json
{
    "code": 200000,
    "data": {
        "accessToken": "eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyQ29udGV4dCI6IntcImlkXCI6XCIxXCIsXCJpc1N1cGVyXCI6ZmFsc2UsXCJsb25nVGVybVwiOmZhbHNlLFwibmlja05hbWVcIjpcImxmalwiLFwicm9sZVwiOjEsXCJ1c2VybmFtZVwiOlwibGZqXCJ9Iiwic3ViIjoibGZqIiwiZXhwIjoxNzEwNjgxODczfQ.njjSGM2Y_t06P6tq-rG11blawBLaf8pZvsdxVMxh9jY",
        "refreshToken": "eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyQ29udGV4dCI6IntcImlkXCI6XCIxXCIsXCJpc1N1cGVyXCI6ZmFsc2UsXCJsb25nVGVybVwiOmZhbHNlLFwibmlja05hbWVcIjpcImxmalwiLFwicm9sZVwiOjEsXCJ1c2VybmFtZVwiOlwibGZqXCJ9Iiwic3ViIjoibGZqIiwiZXhwIjoxNzExMzczMDczfQ.wbkRtLAyuXbeCGXTkU6g1wCxNVw9IeVqV8NlYl6mkfA"
    },
    "message": "å“åº”æˆåŠŸ"
}
~~~

## Token å®ä½“ç±»

```java
package com.mszlu.shop.common.security;

import lombok.Data;

/**
 * Token å®ä½“ç±»
 */
@Data
public class Token {
    /**
     * è®¿é—®token
     */
    private String accessToken;

    /**
     * åˆ·æ–°token
     */
    private String refreshToken;

}
```

## ç”¨æˆ·è¡¨

```sql
-- ----------------------------
-- Table structure for user
-- ----------------------------
DROP TABLE IF EXISTS `user`;
CREATE TABLE `user` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `phone` varchar(255) NOT NULL,
  `username` varchar(255) NOT NULL,
  `password` varchar(255) NOT NULL,
  `gender` char(255) NOT NULL,
  `trueName` varchar(255) DEFAULT NULL,
  `birthday` varchar(255) DEFAULT NULL,
  `email` varchar(255) DEFAULT NULL,
  `personalBrief` varchar(255) DEFAULT NULL,
  `avatarImgUrl` text NOT NULL,
  `recentlyLanded` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of user
-- ----------------------------
INSERT INTO `user` VALUES ('1', '19940790216', 'å¼ æµ·æ´‹', 'a3caed36f0fe5a01e5f144db8927235e', 'male', 'å¼ æµ·æ´‹', '1997-07-05', '1125694337@qq.com', '', 'https://zhy-myblog.oss-cn-shenzhen.aliyuncs.com/public/user/avatar/å¼ æµ·æ´‹/1575283189.png', '2019-12-02 18:31:15');

-- ----------------------------
-- Table structure for user_role
-- ----------------------------
DROP TABLE IF EXISTS `user_role`;
CREATE TABLE `user_role` (
  `User_id` int(11) NOT NULL,
  `Role_id` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of user_role
-- ----------------------------
INSERT INTO `user_role` VALUES ('1', '1');
INSERT INTO `user_role` VALUES ('1', '2');
INSERT INTO `user_role` VALUES ('1', '3');

```

## æ ¸å¿ƒå®ç°

```java
	public ResponseResult<Token> usernameLogin(String username, String password) {
		/**
		 1. æ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾Memberä¿¡æ¯
		 2. å¦‚æœä¸ºnullï¼Œå°±æ˜¯ç”¨æˆ·ä¸å­˜åœ¨
		 3. å¯†ç è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœä¸åŒ¹é… å¯†ç ä¸æ­£ç¡®
		 4. token ç”Ÿæˆtoken
		 5. jwt ç”Ÿæˆtoken, tokenæ”¾å…¥rediså½“ä¸­ï¼ŒaccessToken è¿‡æœŸçŸ­ï¼Œ refreshToken è¿‡æœŸé•¿
		 **/
		LambdaQueryWrapper<User> queryWrapper = new LambdaQueryWrapper<User>()
				.eq(User::getUsername, username);
		List<User> userList = this.list(queryWrapper);

		User user = userList.get(0);
		if (ObjectUtils.isEmpty(user)) {
			return ResponseResult.accountNotFoundError();
		}

		//ç”¨çš„securityçš„å¯†ç ç±»
		if (!new BCryptPasswordEncoder().matches(password, user.getPassword())) {
			return ResponseResult.accountError();
		}

		//ä¸€èˆ¬ä¼šç™»å½•çš„æ—¶å€™ï¼Œè®°å½• ç”¨æˆ·çš„æœ€åä¸€æ¬¡ç™»å½•æ—¶é—´
		//MQ è€ƒè™‘ä½¿ç”¨mq æŠŠä¿¡æ¯å‘åˆ°mqå½“ä¸­ï¼Œç”±mqçš„æ¶ˆè´¹è€… æ¥å»æ›´æ–°1
		user.setRecentlylanded(LocalDateTime.now());
		this.updateById(user);
		Token token = genToken(user);
		return ResponseResult.success(token);
	}

	private Token genToken(User user) {
		Token token = new Token();
		// tokenå­˜æ”¾ä¿¡æ¯
		AuthUser authUser = new AuthUser(user.getUsername(), String.valueOf(user.getId()),
				user.getUsername(), UserEnums.USER);
		// 7å¤©
		String accessToken = TokenUtils.createToken(user.getUsername(), authUser, 7 * 24 * 60 * 60 * 1000L);
		token.setAccessToken(accessToken);
		redisTemplate.opsForValue().set(CachePrefix.ACCESS_TOKEN.name() + UserEnums.MEMBER.name() + jwtToken, "1", 7, TimeUnit.DAYS);
		// 15å¤©
		//è®¾ç½®åˆ·æ–°tokenï¼Œå½“accessTokenè¿‡æœŸçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡refreshTokenæ¥ é‡æ–°è·å–accessToken è€Œä¸ç”¨è®¿é—®æ•°æ®åº“
		String refreshToken = TokenUtils.createToken(user.getUsername(), authUser, 15 * 24 * 60 * 60 * 1000L);
		token.setRefreshToken(refreshToken);
		redisTemplate.opsForValue().set(CachePrefix.REFRESH_TOKEN.name() + UserEnums.MEMBER.name() + jwtToken, "1", 15, TimeUnit.DAYS);

		return token;
	}
```

### æ‰€éœ€æŠ€æœ¯

#### â‘ spring security  â€”â€” åŠ å¯†åŠåˆ¤æ–­å¯†ç æ˜¯å¦ç›¸åŒ

```XML
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
<dependency>
    <groupId>org.jasypt</groupId>
    <artifactId>jasypt-spring-boot-starter</artifactId>
</dependency>
```

æ•°æ®å­˜å…¥[æ•°æ®åº“](https://so.csdn.net/so/search?q=æ•°æ®åº“&spm=1001.2101.3001.7020)åº“æ—¶

```JAVA
public static void main(String[] args) {
System.out.println(new BCryptPasswordEncoder().encode("123456"));
}
```

å½“éœ€è¦ç™»å½•æ—¶ï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™è¡Œä»£ç è¿›è¡Œè§£å¯†

```java
LambdaQueryWrapper<User> queryWrapper = new LambdaQueryWrapper<User>()
    .eq(User::getUsername, username);
List<User> userList = this.list(queryWrapper);

User user = userList.get(0);
if (ObjectUtils.isEmpty(user)) {
    return ResponseResult.accountNotFoundError();
}

//ç”¨çš„securityçš„å¯†ç ç±»
if (!new BCryptPasswordEncoder().matches(password, user.getPassword())) {
    return ResponseResult.accountError();
}
```

#### â‘¡JWT  â€”â€” ç”Ÿæˆtoken

å…·ä½“è§:      <img src="README.assets/image-20240310212945690.png" alt="image-20240310212945690" style="zoom:67%;" />

ä¾èµ–:

```xml
<!--   tokenåŠ å¯† -->
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt</artifactId>
    <version>0.12.3</version>
</dependency>
<!--   tokenåŠ å¯†ç»“æŸ -->
```

#### â‘¢Redis  â€”â€” ç¼“å­˜

å°±æ˜¯Redisç¼“å­˜çŸ¥è¯†

```
redisTemplate.opsForValue().set(CachePrefix.REFRESH_TOKEN.name() + UserEnums.MEMBER.name() + jwtToken, "1", 15, TimeUnit.DAYS);
```

## æµ‹è¯•

![image-20240310210444090](README.assets/image-20240310210444090.png)

#  ç™»å½•è®¤è¯







# è¡¨è®¾è®¡

## ç”¨æˆ·è¡¨ï¼šuser

| åç§°           | ç±»å‹    | é•¿åº¦ | ä¸»é”®  | éç©º  | æè¿°         |
| -------------- | ------- | ---- | ----- | ----- | ------------ |
| id             | int     | 11   | true  | true  | ä¸»é”®ï¼Œè‡ªå¢   |
| phone          | varchar | 255  | false | true  | æ‰‹æœºå·       |
| username       | varchar | 255  | false | true  | ç”¨æˆ·å       |
| password       | varchar | 255  | false | true  | å¯†ç          |
| gender         | char    | 50   | false | true  | æ€§åˆ«         |
| trueName       | varchar | 255  | false | false | å§“å         |
| birthday       | char    | 100  | false | false | ç”Ÿæ—¥         |
| email          | varchar | 255  | false | false | é‚®ç®±         |
| personalBrief  | varchar | 255  | false | false | ä¸ªäººç®€ä»‹     |
| avatarImgUrl   | varchar | 255  | false | true  | å¤´åƒurl      |
| recentlyLanded | varchar | 255  | false | false | æœ€è¿‘ç™»å½•æ—¶é—´ |
